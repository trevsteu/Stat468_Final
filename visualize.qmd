---
title: "Visualize"
author: "Trevor S"
---

## Setup

We install and load the necessary packages, along with functions from prior chapters and `all_data`.

```{r,  message = FALSE, warning = FALSE}
library(ggplot2)
source("functions.R") # load functions defined in prior chapters

all_data <- read.csv("all_data.csv")
```

## Introduction

In the visualize step, we will perform some EDA (Exploratory Data Analysis) to get a sense of what our data looks like. Specifically, we will see if there are any patterns or trends that may be useful in the [Model chapter](https://trevsteu.github.io/Stat468_Final/model.html).

## Code

We start out by looking at the point share values of one draft. Recall that points share is a measure of how many points a player contributed to their team in the standings (ie not the points that is goals plus assists).

```{r}
all_data |> 
  filter(year == 1996) |> 
  ggplot(aes(x = overall, y = ps)) +
  geom_point() +
  labs(x = "Pick Number", y = "Points Share", 
       title = "Points Share of Players Drafted in 1996")
```

Clearly most players do not generate any points share in their career. In fact, less than half of the players in our dataset ever played in an NHL game:

```{r}
all_data |> 
  filter(gp > 0) |> 
  nrow() / nrow(all_data)
```

We next create two histograms, one of games played (on the left) and one of points share (on the right). Note that we have to pivot the data and put it in long format first:

```{r, message=FALSE}
all_data |> pivot_longer(cols = c(gp, ps),
                         names_to = "metric", 
                         values_to = "value") |> 
  ggplot(aes(value)) + 
  geom_histogram() + 
  facet_wrap(~metric, scales = "free") + 
  labs(title = "Distribution of Games Played and Points Share", 
       subtitle = "Note the plots have different scales", 
       x = "Value", y = "Number of Players") 
```

Clearly both of these are very right-skewed, meaning that a lot of players end up playing 0 games and thus accumulating 0 points share. We may also guess that games played and points share are positively correlated, since better players get to play in more games and thus accumulate more points share. Indeed:

```{r}
cor(all_data$ps, all_data$gp)
```

Because of this, we choose to only include `ps` in our model to avoid potential multicollinearity concerns. Finally, we wish to confirm that players selected later in the draft (ie a higher `overall`) tend to generate more points share in their careers. To check this, we create a plot of the average points shares by players selected at each pick number.

```{r}
all_data |> 
  group_by(overall) |> 
  summarize(mean_ps = mean(ps)) |> 
  ggplot(aes(x = overall, y = mean_ps)) + 
  geom_point() + 
  labs(title = "Mean Points Share by Pick Number", 
       x = "Pick Number", y = "Mean Points Share")
```

We can see that in general points share does tend to decrease later in drafts, and that pick value tends to level off around pick 75, though there are some picks that stick out (for example, pick 205 has an average points share of 13.124, whereas pick 204 has an average point share of 4.856). This particular outlier is due to Henrik Lundqvist and Joe Pavelski being selected at this spot and having a career points share of 173.3 and 130.1, respectively. Very few players drafted this late make it to the NHL (20 of the 25 players in our dataset drafted at pick 205 have a point share greater than 0.3), so two players with very successful careers skewing the data is not surprising.

The lessons to take from this plot when creating a model are that it will be necessary to fit a smooth curve to the model and that the estimated value of pick $n$ should probably be influenced by the historical value of pick $n$ AND the historical value of picks "close" to $n$. With this in mind, we proceed to the Transform step.
